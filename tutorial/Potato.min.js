!function(e){var t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(n,o,function(t){return e[t]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){"use strict";function n(e){const t=s.context,i=Math.floor;let n=null,o=(t,i,n)=>{Object.defineProperties(e,{drawWidth:{value:t},drawHeight:{value:i}}),n&&(e.width=t,e.height=i)},r=()=>({relX:e.relX,relY:e.relY,offsetLeft:e.offsetLeft,offsetTop:e.offsetTop,width:e.width,drawWidth:e.drawWidth,drawHeight:e.drawHeight,scale:e.scale,direction:e.direction}),a=e=>{const{relX:n,relY:o,offsetLeft:a,offsetTop:d,width:h,drawWidth:u,drawHeight:c,scale:f,direction:w}=r();if("right"===w){const r=i(n+a),s=i(o+d);t.drawImage(e,0,0,u,c,r,s,u*f,c*f)}else{const r=i(s.width-h-n+a),w=i(o+d);l(s.width,()=>{t.drawImage(e,0,0,u,c,r,w,u*f,c*f)})}};function l(e,i){t.translate(e,0),t.scale(-1,1),i(),t.translate(e,0),t.scale(-1,1)}return{animation(e,a,d=!1){const h=s.asset.get(e,a);o(h.width,h.image.height,d);let u=0,c=0,f=Object.defineProperties({},{animationFrames:{value:h.image.width/h.width-1},animationInterval:{value:h.interval||s.animationInterval},width:{value:h.width},height:{value:h.image.height},flip:{value:h.flip},onComplete:{value:null,writable:!0}});return n=()=>{((e,n,o)=>{const{relX:a,relY:d,offsetLeft:h,offsetTop:u,width:c,drawWidth:f,drawHeight:w,scale:g,direction:m}=r();if(!n&&"right"===m||n&&"left"===m){const n=i(a+h),r=i(d+u);t.drawImage(e,o*f,0,f,w,n,r,f*g,w*g)}else{const n=i(s.width-c*g-a+h),r=i(d+u);l(s.width,()=>{t.drawImage(e,o*f,0,f,w,n,r,f*g,w*g)})}})(h.image,f.flip,c),u++,u>=f.animationInterval&&(u=0,c++,c>=f.animationFrames&&(c=0,f.onComplete&&f.onComplete.call(this)))},f},clear(){n=null},draw(t){n=()=>t.call(e,s.context)},image(e,t,i=!1){const r=s.asset.get(e,t);o(r.width,r.height,i),n=()=>{a(r)}},mix(e,t){const i=s.canvas.cloneNode(),o=i.getContext("2d");let r=new Image;"static"===e?(o.clearRect(0,0,s.width,s.height),t(o),r.src=i.toDataURL("image/png"),n=()=>{s.context.drawImage(r,0,0)}):"dynamic"===e&&(n=()=>{o.clearRect(0,0,s.width,s.height),t(o),r.src=i.toDataURL("image/png"),s.context.drawImage(r,0,0)})},particle(t,i,o,r,l){const d=s.asset.get(t,i);let h,u;Object.defineProperties(e,{width:{value:0},height:{value:0},drawWidth:{value:d.width},drawHeight:{value:d.height}}),r&&(h=(r[1]-r[0])/o),l&&(u=(l[1]-l[0])/o,e.scale=l[1]),n=()=>{null!=h&&((e.alpha+h<=r[0]||e.alpha+h>=r[1])&&(h=-h),e.alpha+=h),null!=u&&((e.scale+u<=l[0]||e.scale+u>=l[1])&&(u=-u),e.scale+=u),a(d)}},render(){s.context.globalAlpha=e.alpha,n&&n(),s.test&&(s.context.strokeStyle="red",s.context.strokeRect(e.relX,e.relY,e.width,e.height))}}}i.r(t);class o{constructor(e){this.beforeCreate=e.beforeCreate,this.created=e.created,this.beforeUpdate=e.beforeUpdate,this.updated=e.updated,this.beforeDestroy=e.beforeDestroy,this.destroyed=e.destroyed,this.beforeCreate&&this.beforeCreate();const t=e.config;if(this.id=t.id,this.x=t.x||0,this.y=t.y||0,this.width=t.width||0,this.height=t.height||0,this.offsetLeft=t.offsetLeft||0,this.offsetTop=t.offsetTop||0,this.global=t.global||!1,this.alpha=null==t.alpha?1:t.alpha,this.scale=null==t.scale?1:t.scale,this.direction=t.direction||"right",this.layer=t.layer||0,this.disabled=t.disabled||!1,this.fixed=t.fixed||0,null==this.id)throw new Error("Sprite needs an id.");if(this.id instanceof Number||!isNaN(Number(this.id)))throw new Error("Sprite must start with a letter.");for(const t in e.data)this[t]=e.data[t];for(const t in e.methods)this[t]=e.methods[t];this.graphics=n(this),this.audio=function(e){let t={audio:null},i=[];return{cal(){if(!t.audio&&0===i.length)return;const n=e.relX,o=e.relY,r=Math.sqrt(n*n+o*o);if(t.audio&&t.range>0){const e=t.range,i=t.audio;i.volume=r>=e?0:t.defalutVolume*((e-r)/e)}for(let e=0;e<i.length;e++){const t=i[e],n=t.range,o=t.audio;!0!==o.ended?n&&(o.volume=r>=n?0:t.defalutVolume*((n-r)/n)):(i.splice(e,1),o.remove(),e--)}},play(e){const n=e.type,o=e.group,r=e.name,a=e.range||0,l=e.volume||1,d=e.startTime||0,h=e.loop||!0,u=s.asset.get(o,r);if("sound"===n){const e=u.cloneNode();return e.volume=l,e.currentTime=d,e.play(),void i.push({audio:e,defalutVolume:l,range:a})}"music"===n&&(t.audio!==u&&(t.audio=u,t.defalutVolume=l,t.range=a,u.currentTime=d,u.volume=l,u.loop=h),u.play())},stop(){t.pause(),t.currentTime=0},delAll(){t.audio&&t.audio.remove(),i.forEach(e=>{e.audio.remove()})}}}(this),this.event=function(e){let t={};return{add(e,i){t[e]||(t[e]=i)},del(e){t[e]&&delete t[e]},delAll(){t={}},execute(){if(!e.disabled)for(const i in t)t[i].call(e)}}}(this),this.userEvent=function(e){const t=s.userEvents;return{watch(i,n){t[e.id]||(t[e.id]={}),t[e.id][i]=n.bind(e)},unwatch(i){i&&t[e.id]&&t[e.id][i]&&delete s.userEvents[e.id][i]}}}(this),o.mixins&&o.mixins.forEach(e=>{e.call(this)}),s.unit.add(this),e.created&&e.created.call(this)}}function r(e){let t={},i=[];return{add(n){if(t[n.id])throw new Error(`Sprite '${n.id}' exists.`);return Object.defineProperties(n,{game:{value:{width:e.width,height:e.height}},stage:{value:{width:e.stage.width,height:e.stage.height}}}),t[n.id]=n,-1===i.indexOf(n.layer)&&(i.push(n.layer),i.sort()),function(){let e={};i.forEach(i=>{for(const n in t){const o=t[n];o.layer===i&&(e[o.id]=o,delete t[n])}}),t=e}(),n},create(e){new o(e)},del(i){const n=t[i];if(!n)throw new Error(`Unit ${i} doesn't exist`);n.beforeDestroy&&n.beforeDestroy(),delete e.userEvents[i],n.audio.delAll(),delete t[i],n.destroyed&&n.destroyed()},delAll(e){if(e)for(const e in t)this.del(e);else{let e=this.filter(e=>!e.global);for(const t in e)this.del(t)}},find:e=>t[e],filter(e){let i={};for(const n in t){const o=t[n];!0===e(o)&&(i[n]=o)}return i},travel(e){for(const i in t)if(!1===e(t[i]))break}}}function a(e,t){e.mixins||(e.mixins=[]),e.mixins.push(t)}class s{static init(e){function t(e,t){const i=s.userEvents;for(const n in i){const o=i[n];o[e]&&o[e](t)}}function i(e){const t=s.canvas,i=t.clientHeight/s.height;return{x:(e.clientX-t.offsetLeft)/i,y:(e.clientY-t.offsetTop)/i,button:e.button}}function n(e){const t=s.canvas,i=t.clientHeight/s.height,n=e.targetTouches[0];return{x:(n.clientX-t.offsetLeft)/i,y:(n.clientY-t.offsetTop)/i}}Object.defineProperties(this,{canvas:{value:document.getElementById(e.el)},context:{value:document.getElementById(e.el).getContext("2d")},width:{value:e.width},height:{value:e.height},key:{value:null,writable:!0},userEvents:{value:{}},animationInterval:{value:e.animationInterval||16,writable:!0},test:{value:!1,writable:!0},isMobile:{value:l()},imagePath:{value:e.path?e.path.image:"",writable:!0},audioPath:{value:e.path?e.path.audio:"",writable:!0}}),this.asset=function(e,t){let i=[],n={};return{allLoaded(e){i.length>0?Promise.all(i).then(()=>e()):e()},get:(e,t)=>n[e][t],load(o){const r=o.type,a=o.group,s=o.name,l=o.url;if(n[a]||(n[a]={}),!n[a][s])if("image"!==r)if("animation"!==r)"audio"===r&&(n[a][s]=new Audio(t+l));else{const t=new Image;t.src=e+l;const r=new Promise(e=>{t.onload=()=>{n[a][s]={image:t,width:o.width,interval:o.interval,flip:o.flip},e(!0)}});i.push(r)}else{const t=new Image;t.src=e+l;const o=new Promise(e=>{t.onload=()=>{n[a][s]=t,e(!0)}});i.push(o)}}}}(this.imagePath,this.audioPath),this.unit=r(s),this.mix=a,this.canvas.setAttribute("width",this.width+"px"),this.canvas.setAttribute("height",this.height+"px"),window.addEventListener("keydown",e=>{e.stopPropagation(),e.preventDefault(),s.key!==e.key&&(s.key=e.key,t("keydown",e.key))}),window.addEventListener("keyup",e=>{e.stopPropagation(),e.preventDefault(),s.key===e.key&&(s.key=null),t("keyup",e.key)}),window.addEventListener("mousedown",e=>{e.stopPropagation(),e.preventDefault(),s.isMobile||t("mousedown",i(e))}),window.addEventListener("mouseup",e=>{e.stopPropagation(),e.preventDefault(),s.isMobile||t("mousedown",i(e))}),window.addEventListener("touchstart",e=>{t("touchstart",n(e))}),window.addEventListener("touchmove",e=>{t("touchmove",n(e))}),window.addEventListener("touchend",e=>{t("touchend",e)}),window.oncontextmenu=function(){return!1}}}function l(){var e=function(){var e=navigator.userAgent;navigator.appVersion;return{trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&-1==e.indexOf("KHTML"),mobile:!!e.match(/AppleWebKit.*Mobile.*/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1,iPad:e.indexOf("iPad")>-1,webApp:-1==e.indexOf("Safari"),weixin:e.indexOf("MicroMessenger")>-1,qq:" qq"==e.match(/\sQQ/i)}}();(navigator.browserLanguage||navigator.language).toLowerCase();return!!(e.mobile||e.ios||e.android||e.iPhone||e.iPad)}function d(e){let t={x:0,y:0,scale:1,follow:null,movement:null},i=(i,n,o,r,a=!0)=>{let l=o*s.frames||1,d=i/l,h=n/l;if(0===d&&0===h)return;t.follow=null;const u=e.width,c=s.width;t.x<0&&(t.x=0),t.x>u-c&&(t.x=u-c);let f=0;!0===a&&s.unit.travel(e=>{e.disabled=!0}),t.movement=()=>{if(t.x+=d,t.y+=h,f++,f>l||t.x<=0||t.x>=u-c)return t.movement=null,!0===a&&s.unit.travel(e=>{e.disabled=!1}),void(r&&r())}};function n(t){const i=t.x,n=t.y,o=t.width,r=t.height,a=e.width,l=e.height,d=s.width,h=s.height;let u,c;return u=i<(d-o)/2?0:i>a-(d+o)/2?a-d:i-(d-o)/2,c=n<(h-r)/2?0:n>l-(h+r)/2?l-h:n-(h-r)/2,{x:u,y:c}}return{follow(e){e!==t.follow&&(t.follow=e)},get:()=>((()=>{const e=t.follow;if(e){const i=n(e);t.x=i.x,t.y=i.y}else t.movement&&t.movement()})(),Object.assign({},t)),move(e,t,n,o){i(e,t,n,o)},moveTo(e,o,r){const{x:a,y:s}=n(e);i(a-t.x,s-t.y,o,r)},unFollow(){t.follow=null}}}class h{constructor(e){s.asset.allLoaded(()=>{s.stage&&s.stage.execute.destory(),this.beforeCreate=e.beforeCreate,this.created=e.created,this.beforeUpdate=e.beforeUpdate,this.updated=e.updated,this.beforeDestroy=e.beforeDestroy,this.destoryed=e.destoryed,this.beforeCreate&&this.beforeCreate(),s.key=null,s.stage=this;const t=e.config;this.width=t&&t.width||s.width,this.height=t&&t.height||s.height,this.camera=d(this),this.event=function(e){let t={};return{add(i,...n){t[i.name]&&reutrn,t[i.name]=i.bind(e,...n)},del(e){t[e]&&delete t[e]},once(i,...n){t[i.name]||(t[i.name]=()=>{i.call(e,...n),delete t[i.name]})},execute(){for(const i in t)t[i].call(e)}}}(this),this.geometry=function(){function e(e,t){return{x1:e.x,y1:e.y,w1:e.width,h1:e.height,x2:t.x,y2:t.y,w2:t.width,h2:t.height}}return{above(t,i){const{x1:n,y1:o,w1:r,h1:a,x2:s,y2:l,w2:d,h2:h}=e(t,i);return o+a<=l&&n+r>=s&&n<=s+d},contain(t,i){const{x1:n,y1:o,w1:r,h1:a,x2:s,y2:l,w2:d,h2:h}=e(t,i);return!(r<d&&a<h&&(n<=s||n+r>=s+d)&&(o<=l||o+a>=l+h))},distance(t,i,n){const{x1:o,y1:r,w1:a,h1:s,x2:l,y2:d,w2:h,h2:u}=e(i,n);return"y"===t?d>r+s?d-(r+s):r>d+u?r-(d+u):0:"x"===t?l>o+a?l-(o+a):o>l+h?o-(l+h):0:void 0},intersect(t,i){const{x1:n,y1:o,w1:r,h1:a,x2:s,y2:l,w2:d,h2:h}=e(t,i);return!(n>=s+d||n+r<=s||o>=l+h||o+a<=l)},onRight(t,i){const{x1:n,y1:o,w1:r,h1:a,x2:s,y2:l,w2:d,h2:h}=e(t,i);return n>=s+d&&o+a>=l&&o<=l+h},onLeft(t,i){const{x1:n,y1:o,w1:r,h1:a,x2:s,y2:l,w2:d,h2:h}=e(t,i);return n+r<=s&&o+a>=l&&o<=l+h},tangent(t,i){const{x1:n,y1:o,w1:r,h1:a,x2:s,y2:l,w2:d,h2:h}=e(t,i);return!(n>s+d||n+r<s||o>l+h||o+a<l)},under(t,i){const{x1:n,y1:o,w1:r,h1:a,x2:s,y2:l,w2:d,h2:h}=e(t,i);return o>=l+h&&n+r>=s&&n<=s+d}}}(),this.execute=function(e){let t=!1;function i(){if(t)return;e.beforeUpdate&&e.beforeUpdate(),s.context.clearRect(0,0,s.width,s.height);let n=e.camera.get();e.event.execute(),s.unit.travel(e=>{!function(e,t){e.beforeUpdate&&e.beforeUpdate(),e.relX=e.x-t.x*(1-e.fixed),e.relY=e.y-t.y*(1-e.fixed),e.audio.cal(),e.graphics.render(),e.event.execute(),e.updated&&e.updated()}(e,n)}),e.updated&&e.updated(),window.requestAnimationFrame(i)}return{destory(){e.beforeDestroy&&e.beforeDestroy(),t=!0,s.unit.delAll(),e.destoryed&&e.destoryed()},loop(){i()}}}(this),h.mixins&&h.mixins.forEach(e=>{e.call(this)}),this.created&&this.created.call(this),this.execute.loop()})}}console.log("Potato | version:0.3 | author:Roanne");window.Potato={Game:s,Stage:h,Sprite:o}}]);