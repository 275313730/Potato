!function(e){var t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(n,o,function(t){return e[t]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){"use strict";function n(e){let t={},i=[];return{add(n){if(t[n.id])throw new Error(`Sprite '${n.id}' exists.`);return Object.defineProperties(n,{game:{value:{width:e.width,height:e.height}},stage:{value:{width:e.stage.width,height:e.stage.height}}}),t[n.id]=n,-1===i.indexOf(n.layer)&&(i.push(n.layer),i.sort()),function(){let e={};i.forEach(i=>{for(const n in t){const o=t[n];o.layer===i&&(e[o.id]=o,delete t[n])}}),t=e}(),n},del(i){const n=t[i];if(!n)throw new Error(`Unit ${i} doesn't exist`);n.beforeDestroy&&n.beforeDestroy(),delete e.userEvents[i],n.audio.delAll(),delete t[i],n.destroyed&&n.destroyed()},delAll(e){for(const i in t){const n=t[i];!e&&n.global||this.del(i)}},find:e=>t[e],filter(e){let i={};for(const n in t){const o=t[n];!0===e(o)&&(i[n]=o)}return i},travel(e){for(const i in t)if(!1===e(t[i]))break}}}i.r(t);class o{static init(e){function t(e,t){const i=o.userEvents;for(const n in i){const o=i[n];o[e]&&o[e](t)}}Object.defineProperties(this,{canvas:{value:document.getElementById(e.el)},width:{value:e.width},height:{value:e.height},key:{value:null,writable:!0},userEvents:{value:{}},animationInterval:{value:e.animationInterval||16,writable:!0},test:{value:!1,writable:!0},isMobile:{value:r()},imagePath:{value:e.path?e.path.image:"",writable:!0},audioPath:{value:e.path?e.path.audio:"",writable:!0}}),this.asset=function(e){const t=e.imagePath,i=e.audioPath;let n=[],o={};return{allLoaded(e){n.length>0?Promise.all(n).then(()=>e()):e()},get:(e,t)=>o[e][t],load(e){const r=e.type,a=e.group,s=e.name,l=e.url;if(o[a]||(o[a]={}),!o[a][s]){if("image"===r){const e=new Image;return n.push(new Promise(t=>{e.onload=()=>{o[a][s]=e,t(!0)}})),void(e.src=t+l)}if("animation"===r){const i=new Image;return n.push(new Promise(t=>{i.onload=()=>{o[a][s]={image:i,width:e.width,interval:e.interval,flip:e.flip},t(!0)}})),void(i.src=t+l)}"audio"===r&&(o[a][s]=new Audio(i+l))}}}}(this),this.unit=n(this),this.mix=function(e,t){e.mixins||(e.mixins=[]),e.mixins.push(t)},this.canvas.setAttribute("width",this.width+"px"),this.canvas.setAttribute("height",this.height+"px"),window.addEventListener("keydown",e=>{e.stopPropagation(),e.preventDefault(),o.key!==e.key&&(o.key=e.key,t("keydown",e.key))}),window.addEventListener("keyup",e=>{e.stopPropagation(),e.preventDefault(),o.key===e.key&&(o.key=null),t("keyup",e.key)}),window.addEventListener("mousedown",e=>{e.stopPropagation(),e.preventDefault(),o.isMobile||t("mousedown",a(e))}),window.addEventListener("mouseup",e=>{e.stopPropagation(),e.preventDefault(),o.isMobile||t("mousedown",a(e))}),window.addEventListener("touchstart",e=>{t("touchstart",s(e))}),window.addEventListener("touchmove",e=>{t("touchmove",s(e))}),window.addEventListener("touchend",e=>{t("touchend",s(e))}),window.oncontextmenu=function(){return!1}}}function r(){var e,t={trident:(e=navigator.userAgent).indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&-1==e.indexOf("KHTML"),mobile:!!e.match(/AppleWebKit.*Mobile.*/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1,iPad:e.indexOf("iPad")>-1,webApp:-1==e.indexOf("Safari"),weixin:e.indexOf("MicroMessenger")>-1,qq:" qq"==e.match(/\sQQ/i)};(navigator.browserLanguage||navigator.language).toLowerCase();return!!(t.mobile||t.ios||t.android||t.iPhone||t.iPad)}function a(e){const t=o.canvas,i=t.clientHeight/o.height;return{x:(e.clientX-t.offsetLeft)/i,y:(e.clientY-t.offsetTop)/i,button:e.button}}function s(e){const t=o.canvas,i=t.clientHeight/o.height;let n=[];for(let o=0;o<e.targetTouches.length;o++){const r=e.targetTouches[o];n.push({x:(r.clientX-t.offsetLeft)/i,y:(r.clientY-t.offsetTop)/i,id:r.identifier,type:e.type})}return n}function l(e){let t={x:0,y:0,scale:1,follow:null,movement:null},i=(i,n,r,a,s=!0)=>{let l=r*o.frames||1,d=i/l,h=n/l;if(0===d&&0===h)return;t.follow=null;const u=e.width,c=o.width;t.x<0&&(t.x=0),t.x>u-c&&(t.x=u-c);let f=0;!0===s&&o.unit.travel(e=>{e.disabled=!0}),t.movement=()=>{if(t.x+=d,t.y+=h,f++,f>l||t.x<=0||t.x>=u-c)return t.movement=null,!0===s&&o.unit.travel(e=>{e.disabled=!1}),void(a&&a())}};function n(t){const i=t.x,n=t.y,r=t.width,a=t.height,s=e.width,l=e.height,d=o.width,h=o.height;let u,c;return u=i<(d-r)/2?0:i>s-(d+r)/2?s-d:i-(d-r)/2,c=n<(h-a)/2?0:n>l-(h+a)/2?l-h:n-(h-a)/2,{x:u,y:c}}return{follow(e){e!==t.follow&&(t.follow=e)},get:()=>((()=>{const e=t.follow;if(e){const i=n(e);t.x=i.x,t.y=i.y}else t.movement&&t.movement()})(),Object.assign({},t)),move(e,t,n,o){i(e,t,n,o)},moveTo(e,o,r){const{x:a,y:s}=n(e);i(a-t.x,s-t.y,o,r)},unFollow(){t.follow=null}}}class d{constructor(e){o.asset.allLoaded(()=>{o.stage&&o.stage.execute.destory(),this.beforeCreate=e.beforeCreate,this.created=e.created,this.beforeUpdate=e.beforeUpdate,this.updated=e.updated,this.beforeDestroy=e.beforeDestroy,this.destoryed=e.destoryed,this.beforeCreate&&this.beforeCreate(),o.key=null,o.stage=this;const t=e.config;this.width=t&&t.width||o.width,this.height=t&&t.height||o.height,this.camera=l(this),this.event=function(e){let t={};return{add(i,n,...o){t[i]&&reutrn,t[i]=n.bind(e,...o)},del(e){t[e]&&delete t[e]},execute(){for(const i in t)t[i].call(e)}}}(this),this.geometry=function(){function e(e,t){return{x1:e.x,y1:e.y,w1:e.width,h1:e.height,x2:t.x,y2:t.y,w2:t.width,h2:t.height}}return{above(t,i){const{x1:n,y1:o,w1:r,h1:a,x2:s,y2:l,w2:d}=e(t,i);return o+a<=l&&n+r>=s&&n<=s+d},contain(t,i){const{x1:n,y1:o,w1:r,h1:a,x2:s,y2:l,w2:d,h2:h}=e(t,i);return!(r<d&&a<h&&(n<=s||n+r>=s+d)&&(o<=l||o+a>=l+h))},distance(t,i,n){const{x1:o,y1:r,w1:a,h1:s,x2:l,y2:d,w2:h,h2:u}=e(i,n);return"y"===t?d>r+s?d-(r+s):r>d+u?r-(d+u):0:"x"===t?l>o+a?l-(o+a):o>l+h?o-(l+h):0:void 0},intersect(t,i){const{x1:n,y1:o,w1:r,h1:a,x2:s,y2:l,w2:d,h2:h}=e(t,i);return!(n>=s+d||n+r<=s||o>=l+h||o+a<=l)},onRight(t,i){const{x1:n,y1:o,h1:r,x2:a,y2:s,w2:l,h2:d}=e(t,i);return n>=a+l&&o+r>=s&&o<=s+d},onLeft(t,i){const{x1:n,y1:o,w1:r,h1:a,x2:s,y2:l,h2:d}=e(t,i);return n+r<=s&&o+a>=l&&o<=l+d},tangent(t,i){const{x1:n,y1:o,w1:r,h1:a,x2:s,y2:l,w2:d,h2:h}=e(t,i);return!(n>s+d||n+r<s||o>l+h||o+a<l)},under(t,i){const{x1:n,y1:o,w1:r,x2:a,y2:s,w2:l,h2:d}=e(t,i);return o>=s+d&&n+r>=a&&n<=a+l}}}(),this.execute=function(e){const t=o.canvas.getContext("2d");let i=!1;function n(){if(i)return;e.beforeUpdate&&e.beforeUpdate();let r=e.camera.get();e.event.execute(),t.clearRect(0,0,o.width,o.height),o.unit.travel(e=>{!function(e,t){e.beforeUpdate&&e.beforeUpdate(),e.relX=e.x-t.x*(1-e.fixed),e.relY=e.y-t.y*(1-e.fixed),e.audio.cal(),e.graphics.render(),e.event.execute(),e.updated&&e.updated()}(e,r)}),e.updated&&e.updated(),window.requestAnimationFrame(n)}return{destory(){e.beforeDestroy&&e.beforeDestroy(),i=!0,o.unit.delAll(),e.destoryed&&e.destoryed()},loop(){n()}}}(this),d.mixins&&d.mixins.forEach(e=>{e.call(this)}),this.created&&this.created.call(this),this.execute.loop()})}}function h(e){const t=o.canvas.getContext("2d"),i=Math.floor;let n=null,r=(t,i,n)=>{Object.defineProperties(e,{drawWidth:{value:t},drawHeight:{value:i}}),n&&(e.width=t,e.height=i)},a=()=>({relX:e.relX,relY:e.relY,offsetLeft:e.offsetLeft,offsetTop:e.offsetTop,width:e.width,drawWidth:e.drawWidth,drawHeight:e.drawHeight,scale:e.scale,direction:e.direction}),s=e=>{const{relX:n,relY:r,offsetLeft:s,offsetTop:d,width:h,drawWidth:u,drawHeight:c,scale:f,direction:w}=a();if("right"===w){const o=i(n+s),a=i(r+d);t.drawImage(e,0,0,u,c,o,a,u*f,c*f)}else{const a=i(o.width-h-n+s),w=i(r+d);l(o.width,()=>{t.drawImage(e,0,0,u,c,a,w,u*f,c*f)})}};function l(e,i){t.translate(e,0),t.scale(-1,1),i(),t.translate(e,0),t.scale(-1,1)}return{animation(e,s,d=!1){const h=o.asset.get(e,s);r(h.width,h.image.height,d);let u=0,c=0,f=Object.defineProperties({},{animationFrames:{value:h.image.width/h.width-1},animationInterval:{value:h.interval||o.animationInterval},width:{value:h.width},height:{value:h.image.height},flip:{value:h.flip},onComplete:{value:null,writable:!0}});return n=()=>{((e,n,r)=>{const{relX:s,relY:d,offsetLeft:h,offsetTop:u,width:c,drawWidth:f,drawHeight:w,scale:g,direction:p}=a();if(!n&&"right"===p||n&&"left"===p){const n=i(s+h),o=i(d+u);t.drawImage(e,r*f,0,f,w,n,o,f*g,w*g)}else{const n=i(o.width-c*g-s+h),a=i(d+u);l(o.width,()=>{t.drawImage(e,r*f,0,f,w,n,a,f*g,w*g)})}})(h.image,f.flip,c),u++,u>=f.animationInterval&&(u=0,c++,c>=f.animationFrames&&(c=0,f.onComplete&&f.onComplete.call(this)))},f},clear(){n=null},draw(i){n=()=>i.call(e,t)},image(e,t,i=!1){const a=o.asset.get(e,t);r(a.width,a.height,i),n=()=>{s(a)}},mix(e,i){const r=o.canvas.cloneNode(),a=r.getContext("2d");let s=new Image;"static"===e?(a.clearRect(0,0,o.width,o.height),i(a),s.src=r.toDataURL("image/png"),n=()=>{t.drawImage(s,0,0)}):"dynamic"===e&&(n=()=>{a.clearRect(0,0,o.width,o.height),i(a),s.src=r.toDataURL("image/png"),t.drawImage(s,0,0)})},particle(t,i,r,a,l){const d=o.asset.get(t,i);let h,u;Object.defineProperties(e,{width:{value:0},height:{value:0},drawWidth:{value:d.width},drawHeight:{value:d.height}}),a&&(h=(a[1]-a[0])/r),l&&(u=(l[1]-l[0])/r,e.scale=l[1]),n=()=>{null!=h&&((e.alpha+h<=a[0]||e.alpha+h>=a[1])&&(h=-h),e.alpha+=h),null!=u&&((e.scale+u<=l[0]||e.scale+u>=l[1])&&(u=-u),e.scale+=u),s(d)}},render(){const i=o.width,r=o.height,a=e.relX,s=e.relY,l=e.width,d=e.height,h=e.scale;a+l*h<0||a>i||s+d*h<0||s>r||(t.globalAlpha=e.alpha,n&&n(),o.test&&(t.strokeStyle="red",t.strokeRect(e.relX,e.relY,e.width,e.height)))}}}class u{constructor(e){this.beforeCreate=e.beforeCreate,this.created=e.created,this.beforeUpdate=e.beforeUpdate,this.updated=e.updated,this.beforeDestroy=e.beforeDestroy,this.destroyed=e.destroyed,this.beforeCreate&&this.beforeCreate();const t=e.config;if(Object.defineProperty(this,"id",{value:t.id}),this.x=t.x||0,this.y=t.y||0,this.width=t.width||0,this.height=t.height||0,this.offsetLeft=t.offsetLeft||0,this.offsetTop=t.offsetTop||0,this.global=t.global||!1,this.alpha=null==t.alpha?1:t.alpha,this.scale=null==t.scale?1:t.scale,this.direction=t.direction||"right",this.layer=t.layer||0,this.disabled=t.disabled||!1,this.fixed=t.fixed||0,null==this.id)throw new Error("Sprite needs an id.");if(this.id instanceof Number||!isNaN(Number(this.id)))throw new Error("Sprite must start with a letter.");for(const t in e.data)this[t]=e.data[t];for(const t in e.methods)this[t]=e.methods[t];this.graphics=h(this),this.audio=function(e){let t={audio:null},i=[];return{cal(){if(!t.audio&&0===i.length)return;const n=e.relX,o=e.relY,r=Math.sqrt(n*n+o*o);if(t.audio&&t.range>0){const e=t.range;a(t.audio,e,t.defalutVolume,r)}for(let e=0;e<i.length;e++){const t=i[e],n=t.range,o=t.audio;!0!==o.ended?a(o,n,t.defalutVolume,r):(i.splice(e,1),o.remove(),e--)}function a(e,t,i,n){t&&(e.volume=n>=t?0:i*((t-n)/t))}},play(e){const n=e.type,r=e.group,a=e.name,s=e.range||0,l=e.volume||1,d=e.startTime||0,h=e.loop||!0,u=o.asset.get(r,a);if("sound"===n){const e=u.cloneNode();return e.volume=l,e.currentTime=d,e.play(),void i.push({audio:e,defalutVolume:l,range:s})}"music"===n&&(t.audio!==u&&(t.audio=u,t.defalutVolume=l,t.range=s,u.currentTime=d,u.volume=l,u.loop=h),u.play())},stop(){t.pause(),t.currentTime=0},delAll(){t.audio&&t.audio.remove(),i.forEach(e=>{e.audio.remove()})}}}(this),this.event=function(e){let t={};return{add(e,i){t[e]||(t[e]=i)},del(e){t[e]&&delete t[e]},delAll(){t={}},execute(){if(!e.disabled)for(const i in t)t[i].call(e)}}}(this),this.userEvent=function(e){const t=o.userEvents;return{watch(i,n){t[e.id]||(t[e.id]={}),t[e.id][i]=n.bind(e)},unwatch(i){i&&t[e.id]&&t[e.id][i]&&delete o.userEvents[e.id][i]}}}(this),u.mixins&&u.mixins.forEach(e=>{e.call(this)}),o.unit.add(this),e.created&&e.created.call(this)}}console.log("Potato | version:0.4.1 | author:Roanne");window.Potato={Game:o,Stage:d,Sprite:u}}]);